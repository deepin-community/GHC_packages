#!/usr/bin/make -f

DEB_CABAL_PACKAG = plugins
DEB_HADDOCK_HTML_DIR ?= /usr/share/doc/hs-$(CABAL_PACKAGE)-doc/html/
DEB_BUILD_DEPENDENCIES = build-arch

clean::
	make -C docs clean

include /usr/share/cdbs/1/rules/debhelper.mk
include /usr/share/cdbs/1/rules/simple-patchsys.mk
include /usr/share/cdbs/1/class/hlibrary.mk

# This is to cater for the slightly non-standard -doc package name:
# Also, this builds the pdf and html documentation
build/hs-$(CABAL_PACKAGE)-doc:: dist-ghc6
	mv dist-ghc6 dist
	[ ! -x /usr/bin/haddock ] || $(DEB_SETUP_BIN_NAME) haddock $(DEB_HADDOCK_OPTS)
	make -C docs
	mv dist dist-ghc6

install/hs-$(CABAL_PACKAGE)-doc:: debian/tmp-inst-ghc6
	mv dist-ghc6 dist
	mkdir -p debian/$(notdir $@)/$(DEB_HADDOCK_HTML_DIR)
	cd debian/tmp-inst-ghc6/ ; find ./$(DEB_HADDOCK_HTML_DIR)/ \
		! -name "*.haddock" -exec install -Dm 644 '{}' \
		../$(notdir $@)/'{}' ';'
#	These files are now installed by haskell-devscripts into the -doc package
#	mkdir -p debian/$(notdir $@)/$(DEB_HADDOCK_DIR)
#	cp -r debian/tmp-inst-ghc6/$(DEB_HADDOCK_DIR)/*.haddock \
#		debian/$(notdir $@)/$(DEB_HADDOCK_DIR)
	
	mkdir -p debian/$(notdir $@)/usr/share/doc/hs-$(CABAL_PACKAGE)-doc/plugins
	cp -r docs/hs-plugins/* debian/$(notdir $@)/usr/share/doc/hs-$(CABAL_PACKAGE)-doc/plugins
	cp docs/hs-plugins.pdf debian/$(notdir $@)/usr/share/doc/hs-$(CABAL_PACKAGE)-doc/plugins.pdf
	dh_haskell_depends -p$(notdir $@)
	mv dist dist-ghc6

