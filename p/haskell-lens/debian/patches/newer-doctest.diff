--- a/lens.cabal
+++ b/lens.cabal
@@ -186,7 +186,7 @@
   build-depends:
     base == 4.*,
     directory >= 1.0 && < 1.2,
-    doctest >= 0.8 && <= 0.9,
+    doctest >= 0.9.1 && <= 0.10,
     filepath >= 1.3 && < 1.4
   ghc-options: -Wall -Werror -threaded
   hs-source-dirs: tests
--- a/tests/doctests.hs
+++ b/tests/doctests.hs
@@ -12,7 +12,7 @@
     "-isrc"
   : "-idist/build/autogen"
   : "-optP-include"
-  : "-optPdist/build/autogen/cabal_macros.h"
+  : "-optPdist-ghc/build/autogen/cabal_macros.h"
   : sources

 getSources :: IO [FilePath]
