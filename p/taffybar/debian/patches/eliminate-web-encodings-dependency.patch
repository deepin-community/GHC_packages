From: CJ van den Berg <cj@vdbonline.com>
Subject: Eliminate web-encodings dependency

Origin: upstream, https://github.com/travitch/taffybar/commit/4c2591a25c8700cec29aa28892e4dbfa610ed1e2
Index: taffybar/src/System/Taffybar/FreedesktopNotifications.hs
===================================================================
--- taffybar.orig/src/System/Taffybar/FreedesktopNotifications.hs	2013-07-16 18:20:24.000000000 +0200
+++ taffybar/src/System/Taffybar/FreedesktopNotifications.hs	2013-07-17 21:01:58.000000000 +0200
@@ -28,7 +28,6 @@
 import Data.Word ( Word32 )
 import DBus.Client.Simple
 import Graphics.UI.Gtk hiding ( Variant )
-import Web.Encodings ( decodeHtml, encodeHtml )

 -- | A simple structure representing a Freedesktop notification
 data Notification = Notification { noteAppName :: Text
@@ -116,8 +115,8 @@
       nid <- modifyMVar idSrc (\x -> return (x+1, x))
       let n = Notification { noteAppName = appName
                            , noteReplaceId = 0
-                           , noteSummary = encodeHtml $ decodeHtml summary
-                           , noteBody = encodeHtml $ decodeHtml body
+                           , noteSummary = T.pack $ escapeMarkup $ T.unpack summary
+                           , noteBody = T.pack $ escapeMarkup $ T.unpack body
                            , noteExpireTimeout = tout
                            , noteId = fromIntegral nid
                            }
Index: taffybar/src/System/Taffybar/MPRIS.hs
===================================================================
--- taffybar.orig/src/System/Taffybar/MPRIS.hs	2013-07-16 18:20:24.000000000 +0200
+++ taffybar/src/System/Taffybar/MPRIS.hs	2013-07-17 21:01:58.000000000 +0200
@@ -18,7 +18,6 @@
 import DBus.Types
 import DBus.Message
 import Graphics.UI.Gtk hiding ( Signal, Variant )
-import Web.Encodings ( encodeHtml, decodeHtml )
 import Text.Printf

 setupDBus :: Label -> IO ()
@@ -53,7 +52,7 @@
     Just m -> do
       let artist = maybe "[unknown]" id (variantDictLookup "artist" m)
           track = maybe "[unknown]" id (variantDictLookup "title" m)
-          msg = encodeHtml $ decodeHtml $ printf "%s - %s" (T.unpack artist) (T.unpack track)
+          msg = escapeMarkup $ printf "%s - %s" (T.unpack artist) (T.unpack track)
           txt = "<span fgcolor='yellow'>Now Playing:</span> " ++ msg
       postGUIAsync $ do
         -- In case the widget was hidden due to a stop/pause, forcibly
Index: taffybar/src/System/Taffybar/XMonadLog.hs
===================================================================
--- taffybar.orig/src/System/Taffybar/XMonadLog.hs	2013-07-16 18:20:24.000000000 +0200
+++ taffybar/src/System/Taffybar/XMonadLog.hs	2013-07-17 21:01:58.000000000 +0200
@@ -33,8 +33,6 @@
 import XMonad
 import XMonad.Hooks.DynamicLog

-import Web.Encodings ( decodeHtml, encodeHtml )
-
 -- | This is a DBus-based logger that can be used from XMonad to log
 -- to this widget.  This version lets you specify the format for the
 -- log using a pretty printer (e.g., 'taffybarPP').
@@ -52,7 +50,7 @@
 -- | Escape strings so that they can be safely displayed by Pango in
 -- the bar widget
 taffybarEscape :: String -> String
-taffybarEscape = encodeHtml . decodeHtml
+taffybarEscape = escapeMarkup

 -- | The same as defaultPP in XMonad.Hooks.DynamicLog
 taffybarDefaultPP :: PP
Index: taffybar/taffybar.cabal
===================================================================
--- taffybar.orig/taffybar.cabal	2013-07-16 18:20:24.000000000 +0200
+++ taffybar/taffybar.cabal	2013-07-17 21:01:58.000000000 +0200
@@ -58,7 +58,7 @@
 library
   default-language: Haskell2010
   build-depends: base > 3 && < 5, time, old-locale, containers, text, HTTP,
-                 parsec >= 3.1, mtl >= 2, network, web-encodings, cairo,
+                 parsec >= 3.1, mtl >= 2, network, cairo,
                  dbus-core >= 0.9.1 && < 1.0, gtk >= 0.12.1, dyre >= 0.8.6,
                  HStringTemplate, gtk-traymanager >= 0.1.2 && < 0.2, xmonad-contrib, xmonad,
                  xdg-basedir, filepath, utf8-string, process
