#!/usr/bin/make -f
#
# This file is based on John Goerzen's Cabal Debian template.
# See http://www.n-heptane.com/nhlab/repos/cabalDebianTemplate/
#
# This file is in the public domain.

THIS    := $(shell sed -ne 's/^Source: \(.*\)/\1/p' debian/control)
PREFIX  := /usr
GHC	:= $(firstword $(shell bash -c "type -p ghc6 ghc"))

configure: configure-stamp
configure-stamp:
	dh_testdir

	if [ -e Setup.lhs ]; then $(GHC) --make Setup.lhs -o setup; else $(GHC) --make Setup.hs -o setup; fi
	./setup configure --ghc --prefix=$(PREFIX) $(CONFIGURE_OPTS)

	touch $@

build: build-stamp
build-stamp: configure-stamp
	dh_testdir

	touch $@

clean:
	dh_testdir
	dh_testroot

	-./setup clean
	rm -rf setup Setup.hi Setup.ho Setup.o .*config* dist html
	rm -f configure-stamp build-stamp build-indep-stamp

	dh_clean

install: build
	dh_testdir
	dh_testroot
	dh_clean -k
	dh_installdirs -a
	dh_haskell -a

build-indep: build-indep-stamp
build-indep-stamp:
	dh_testdir

install-indep: build-indep
	dh_testdir
	dh_testroot
	dh_clean -k
	dh_installdirs -i
	dh_haskell -i

# Build architecture-independent files here.
binary-indep: build-indep install-indep
	dh_testdir
	dh_testroot
	dh_installchangelogs -i
	dh_installdocs -i
	dh_installexamples -i
	dh_installman -i
	dh_link -i
	dh_strip -i
	dh_compress -i
	dh_fixperms -i
	dh_installdeb -i
	dh_shlibdeps -i
	dh_gencontrol -i
	dh_md5sums -i
	dh_builddeb -i

# Build architecture-dependent files here.
binary-arch: build install
	dh_testdir
	dh_testroot
	dh_installchangelogs -a
	dh_installdocs -a
	dh_installexamples -a
	dh_installman -a
	dh_link -a
	dh_strip -a
	dh_compress -a
	dh_fixperms -a
	dh_installdeb -a
	dh_shlibdeps -a
	dh_gencontrol -a
	dh_md5sums -a
	dh_builddeb -a

binary: binary-indep binary-arch
.PHONY: build clean binary-indep binary-arch binary install build-indep install-indep
