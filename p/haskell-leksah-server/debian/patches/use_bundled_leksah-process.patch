Index: haskell-leksah-server-0.10.0.4/leksah-server.cabal
===================================================================
--- haskell-leksah-server-0.10.0.4.orig/leksah-server.cabal	2011-04-21 10:46:32.000000000 +0200
+++ haskell-leksah-server-0.10.0.4/leksah-server.cabal	2011-05-27 17:30:41.000000000 +0200
@@ -36,7 +36,7 @@
                containers >=0.2.0.0 && <0.5,
                directory >=1.0.0.2 && <1.2, filepath >=1.1.0.1 && <1.3, ghc >=6.10.1 && <7.1,
                ltk >=0.9 && <1.0, mtl >=1.1.0.2 && <2.1, parsec >=2.1.0.1 && <3.2,
-               pretty >=1.0.1.0 && <1.1, process-leksah >=1.0.1.3 && <1.1, time >=1.1 && <1.3, deepseq >=1.1 && <1.2,
+               pretty >=1.0.1.0 && <1.1, time >=1.1 && <1.3, deepseq >=1.1 && <1.2,
                hslogger >= 1.0.7 && <1.2, network >=2.2 && <3.0
     if (impl(ghc >= 6.12))
        build-depends: haddock >= 2.7.2 && <2.10
@@ -72,13 +72,27 @@
        ghc-options: -Wall -ferror-spans -O2
     ghc-prof-options: -auto-all -prof

+    exposed-modules:
+        IDE.System.Process
+    if impl(ghc)
+        exposed-modules:
+          IDE.System.Process.Internals
+    c-sources:
+        process-leksah/cbits/runProcess.c
+    include-dirs: process-leksah/include
+    includes:
+        runProcess.h
+    cpp-options: -Dbase4
+    hs-source-dirs: process-leksah
+
+
 executable leksah-server
     build-depends: Cabal >=1.6.0.1 && <1.11, base >= 4.0.0.0 && <4.4, binary >=0.5.0.0 && <0.6,
                binary-shared >=0.8 && <0.9, bytestring >=0.9.0.1 && <0.10,
                containers >=0.2.0.0 && <0.5,
                directory >=1.0.0.2 && <1.2, filepath >=1.1.0.1 && <1.3, ghc >=6.10.1 && <7.1,
                ltk >=0.9 && <1.0, mtl >=1.1.0.2 && <2.1, parsec >=2.1.0.1 && <3.2,
-               pretty >=1.0.1.0 && <1.1, process-leksah >=1.0.1.3 && <1.1, time >=1.1 && <1.3, deepseq >=1.1 && <1.2,
+               pretty >=1.0.1.0 && <1.1, time >=1.1 && <1.3, deepseq >=1.1 && <1.2,
                hslogger >= 1.0.7 && <1.2, network >=2.2 && <3.0
     if (impl(ghc >= 6.12))
        build-depends: haddock >= 2.7.2 && <2.10
@@ -120,6 +134,13 @@
         ghc-options: -Wall -ferror-spans -O2
     ghc-prof-options: -auto-all -prof

+    -- Bundled leksah-process
+    c-sources:
+        process-leksah/cbits/runProcess.c
+    include-dirs: process-leksah/include
+    cpp-options: -Dbase4
+    hs-source-dirs: process-leksah
+
 executable leksahecho
     main-is: LeksahEcho.hs
     buildable: True
@@ -139,4 +160,9 @@
     else
        ghc-options: -Wall -ferror-spans -O2

-
+    -- Bundled leksah-process
+    c-sources:
+        process-leksah/cbits/runProcess.c
+    include-dirs: process-leksah/include
+    cpp-options: -Dbase4
+    hs-source-dirs: process-leksah
