Index: ghc-7.0.2/rts/posix/OSThreads.c
===================================================================
--- ghc-7.0.2.orig/rts/posix/OSThreads.c	2011-02-28 23:40:09.000000000 +0530
+++ ghc-7.0.2/rts/posix/OSThreads.c	2011-03-05 19:02:06.000000000 +0530
@@ -7,10 +7,10 @@
  *
  * --------------------------------------------------------------------------*/

-#if defined(__linux__)
+#if defined(__linux__) || defined(__GLIBC__)
 /* We want GNU extensions in DEBUG mode for mutex error checking */
 /* We also want the affinity API, which requires _GNU_SOURCE */
-#define _GNU_SOURCE
+#define _GNU_SOURCE 1
 #endif

 #include "PosixSource.h"
Index: ghc-7.0.2/driver/mangler/ghc-asm.lprl
===================================================================
--- ghc-7.0.2.orig/driver/mangler/ghc-asm.lprl	2011-02-28 23:40:08.000000000 +0530
+++ ghc-7.0.2/driver/mangler/ghc-asm.lprl	2011-03-05 19:02:06.000000000 +0530
@@ -216,7 +216,7 @@
     $T_HDR_vector   = "\.text\n\t\.align 8\n";

     #--------------------------------------------------------#
-    } elsif ( $TargetPlatform =~ /^x86_64-.*-(linux|openbsd|freebsd|dragonfly|netbsd)$/m ) {
+    } elsif ( $TargetPlatform =~ /^x86_64-.*-(linux|openbsd|freebsd|dragonfly|netbsd|kfreebsdgnu)$/m ) {

     $T_STABBY       = 0; # 1 iff .stab things (usually if a.out format)
     $T_US           = ''; # _ if symbols have an underscore on the front
Index: ghc-7.0.2/rts/Linker.c
===================================================================
--- ghc-7.0.2.orig/rts/Linker.c	2011-02-28 23:40:08.000000000 +0530
+++ ghc-7.0.2/rts/Linker.c	2011-03-05 19:04:00.000000000 +0530
@@ -13,8 +13,8 @@
 /* Linux needs _GNU_SOURCE to get RTLD_DEFAULT from <dlfcn.h> and
    MREMAP_MAYMOVE from <sys/mman.h>.
  */
-#ifdef __linux__
-#define _GNU_SOURCE
+#ifdef defined(__linux__)  || defined(__GLIBC__)
+#define _GNU_SOURCE 1
 #endif

 #include "Rts.h"
@@ -73,7 +73,8 @@
 #if defined(linux_HOST_OS    ) || defined(freebsd_HOST_OS) || \
     defined(dragonfly_HOST_OS) || defined(netbsd_HOST_OS ) || \
     defined(openbsd_HOST_OS  ) || \
-    ( defined(darwin_HOST_OS ) && !defined(powerpc_HOST_ARCH) )
+    ( defined(darwin_HOST_OS ) && !defined(powerpc_HOST_ARCH) ) || \
+    defined(kfreebsdgnu_HOST_OS) \
 /* Don't use mmap on powerpc-apple-darwin as mmap doesn't support
  * reallocating but we need to allocate jump islands just after each
  * object images. Otherwise relative branches to jump islands can fail
@@ -89,7 +90,7 @@

 #endif

-#if defined(linux_HOST_OS) || defined(solaris2_HOST_OS) || defined(freebsd_HOST_OS) || defined(dragonfly_HOST_OS) || defined(netbsd_HOST_OS) || defined(openbsd_HOST_OS)
+#if defined(linux_HOST_OS) || defined(solaris2_HOST_OS) || defined(freebsd_HOST_OS) || defined(kfreebsdgnu_HOST_OS) || defined(dragonfly_HOST_OS) || defined(netbsd_HOST_OS) || defined(openbsd_HOST_OS)
 #  define OBJFORMAT_ELF
 #  include <regex.h>    // regex is already used by dlopen() so this is OK
                         // to use here without requiring an additional lib
@@ -1590,7 +1591,7 @@
        } else {
            if ((W_)result > 0x80000000) {
                // oops, we were given memory over 2Gb
-#if defined(freebsd_HOST_OS) || defined(dragonfly_HOST_OS)
+#if defined(freebsd_HOST_OS) || defined(kfreebsdgnu_HOST_OS) || defined(dragonfly_HOST_OS)
                // Some platforms require MAP_FIXED.  This is normally
                // a bad idea, because MAP_FIXED will overwrite
                // existing mappings.
